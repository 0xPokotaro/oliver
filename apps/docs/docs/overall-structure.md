# 全体構造

## 1. ウォレット・セキュリティモデル

「既存ウォレット」と「AI専用スマートアカウント」を組み合わせたハイブリッド管理方式を採用する。

### 1.1 ウォレット構成

#### メインウォレット (既存のEOA / MetaMask等)

- **役割**: 資産の保管庫および「親鍵（Owner）」
- **運用**: AIアカウントへの資金チャージ（送金）と、最終的な権限管理を行う

#### AI専用スマートアカウント (Biconomy Smart Account)

- **役割**: 実決済を行う「買い物用サブ口座」
- **運用**: Biconomy MEE上に構築され、特定の条件下での自律決済を許可される

### 1.2 署名と委任の仕組み（Session Keys）

- **マスター署名**: ユーザーはRaspberry Piを通じ、最初に一度だけメインウォレットで「セッションキー」を発行する
- **限定的な権限**: セッションキーには「期間（例:30日間）」「上限金額（例:2万円）」「対象先（例:猫の餌ECのみ）」の制限を付与する
- **自律決済**: 実際の購入時、AI能力層はこのセッションキーを用いて自動署名を行う。ユーザーは都度署名を行う必要がない

## 2. 採用技術スタック

| 技術・プロトコル | 役割 |
|---|---|
| **Biconomy MEE** | モジュール型実行環境。アカウント抽象化による複雑な決済フローの自動化 |
| **x402 Protocol** | AIエージェント間の支払要求（Payment Required）を処理する通信規格 |
| **ERC-8004** | AIエージェントの身元証明。オンチェーンでの正当性を担保 |
| **EIP-712** | 署名データの構造化。AIが「何を」購入しようとしているかを人間が検証可能にする |
| **EIP-2612 (Permit)** | 署名のみでのトークン転送承認。1ステップでのシームレスな決済を実現 |
| **Raspberry Pi 4** | 物理的な音声インターフェースおよびセッションキーの生成ハブ |

## 3. 運用ワークフロー

1. **初期設定**: ユーザーが既存ウォレットを接続し、AI専用アカウントを作成。Raspberry Piを「信頼できるデバイス」として登録
2. **予算チャージ**: メインウォレットからAI専用アカウントへ必要分（例：JPYC等のステーブルコイン）を送金
3. **指示**: ユーザーが音声で「猫の餌がなくなったら買っておいて」と指示
4. **監視・判断**: AI人格層が履歴から消費期限を予測、または在庫不足を検知
5. **決済実行**:
   - AI能力層がEC側からx402インボイスを受領
   - 付与されたセッションキーの範囲内であることを確認し、自動署名
   - Biconomy Paymasterによりガスレス決済（またはトークン払い）を完了
6. **通知**: 購入完了を音声またはスマートフォンへ通知
