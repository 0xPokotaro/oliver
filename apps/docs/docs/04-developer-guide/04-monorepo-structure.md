# ãƒ¢ãƒãƒ¬ãƒæ§‹æˆ

ã“ã‚Œã¾ã§ã®è­°è«–ï¼ˆRustãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã€ãƒ©ã‚ºãƒ‘ã‚¤ã®ã‚­ã‚ªã‚¹ã‚¯UIã€Webãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼‰ã‚’çµ±åˆã—ãŸã€**æœ€çµ‚çš„ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ**ã‚’ææ¡ˆã—ã¾ã™ã€‚

**TypeScript (Next.js)** ã¨ **Rust (Axum)** ãŒæ··åœ¨ã™ã‚‹ã€Œãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ»ãƒ¢ãƒãƒ¬ãƒã€ã¨ãªã‚Šã¾ã™ã€‚

## ğŸ“‚ Syntropy Monorepo Structure

```text
.
â”œâ”€â”€ apps/                                   # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ (Deployable)
â”‚   â”œâ”€â”€ device-ui/                          # [Next.js] â˜…ãƒ©ã‚ºãƒ‘ã‚¤ç”¨ã‚­ã‚ªã‚¹ã‚¯ã‚¢ãƒ—ãƒª (The Node)
â”‚   â”‚   â”œâ”€â”€ src/app/page.tsx                # ã‚¢ãƒ³ãƒ“ã‚¨ãƒ³ãƒˆå¾…æ©Ÿç”»é¢ & æ±ºæ¸ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”‚   â”œâ”€â”€ src/lib/voice/                  # éŸ³å£°èªè­˜/åˆæˆãƒ­ã‚¸ãƒƒã‚¯ (Web Audio API)
â”‚   â”‚   â””â”€â”€ package.json                    # @syntropy/device-ui
â”‚   â”‚
â”‚   â”œâ”€â”€ dashboard/                          # [Next.js] â˜…è¨­å®šç”¨Webãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
â”‚   â”‚   â”œâ”€â”€ src/app/settings/               # ã‚¦ã‚©ãƒ¬ãƒƒãƒˆæ¥ç¶šã€ãƒãƒªã‚·ãƒ¼è¨­å®šç”»é¢
â”‚   â”‚   â”œâ”€â”€ src/app/history/                # æ±ºæ¸ˆå±¥æ­´é–²è¦§
â”‚   â”‚   â””â”€â”€ package.json                    # @syntropy/dashboard
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                                 # [Rust/Axum] â˜…x402ãƒªã‚½ãƒ¼ã‚¹ã‚µãƒ¼ãƒãƒ¼
â”‚   â”‚   â”œâ”€â”€ src/main.rs                     # APIã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ src/handlers/                   # 402ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã€ç½²åæ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â””â”€â”€ Cargo.toml                      # (name: api)
â”‚   â”‚
â”‚   â”œâ”€â”€ facilitator-api/                    # [Rust/Axum] â˜…ç½²åæ¤œè¨¼ãƒ»å®Ÿè¡Œãƒãƒ¼ãƒ‰
â”‚   â”‚   â”œâ”€â”€ src/chain/                      # Alloyã‚’ä½¿ã£ãŸã‚ªãƒ³ãƒã‚§ãƒ¼ãƒ³å®Ÿè¡Œ
â”‚   â”‚   â”œâ”€â”€ src/verifier/                   # EIP-712/2612 æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â””â”€â”€ Cargo.toml                      # (name: facilitator-api)
â”‚   â”‚
â”‚   â””â”€â”€ docs/                               # [Docusaurus] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”‚
â”œâ”€â”€ packages/                               # å…±æœ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå±¤ (Shared Logic)
â”‚   â”œâ”€â”€ x402-sdk/                           # [TS] Agentç”¨SDK (fetch wrapper, EIP-712ç½²å)
â”‚   â”‚   â”œâ”€â”€ src/client.ts
â”‚   â”‚   â””â”€â”€ package.json                    # @syntropy/x402-sdk
â”‚   â”‚
â”‚   â”œâ”€â”€ types/                              # [TS] â˜…é‡è¦: Rustã¨å…±æœ‰ã™ã‚‹å‹å®šç¾©
â”‚   â”‚   â”œâ”€â”€ src/generated/                  # typeshareç­‰ã§Rustã‹ã‚‰è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸå‹
â”‚   â”‚   â””â”€â”€ package.json                    # @syntropy/types
â”‚   â”‚
â”‚   â”œâ”€â”€ ui/                                 # [TS] å…±é€šUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ src/components/Orb.tsx          # AIã®ã€Œå…‰ã‚‹çƒä½“ã€ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼
â”‚   â”‚   â”œâ”€â”€ src/styles/                     # Tailwindè¨­å®šãƒ»å…±é€šã‚«ãƒ©ãƒ¼
â”‚   â”‚   â””â”€â”€ package.json                    # @syntropy/ui
â”‚   â”‚
â”‚   â”œâ”€â”€ contracts/                          # [Solidity] ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆ
â”‚   â”‚   â”œâ”€â”€ contracts/Escrow.sol
â”‚   â”‚   â””â”€â”€ package.json                    # @syntropy/contracts
â”‚   â”‚
â”‚   â””â”€â”€ config/                             # [Config] TSConfig, ESLint
â”‚
â”œâ”€â”€ cargo-workspace/                        # Rustãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹å®šç¾©
â”‚   â””â”€â”€ Cargo.toml                          # apps/api, apps/facilitator-api ã‚’æŒ‡å®š
â”‚
â”œâ”€â”€ pnpm-workspace.yaml                     # pnpmãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹å®šç¾©
â”œâ”€â”€ package.json                            # ãƒ«ãƒ¼ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆå®šç¾©
â””â”€â”€ rust-toolchain.toml                     # Rustãƒãƒ¼ã‚¸ãƒ§ãƒ³å›ºå®š
```

---

## ğŸ”‘ ã“ã®æ§‹æˆã®é‡è¦ãƒã‚¤ãƒ³ãƒˆ

### 1. `apps/device-ui` (The Node)
ãƒ©ã‚ºãƒ‘ã‚¤ã§å‹•ãã‚¢ãƒ—ãƒªã§ã™ã€‚
*   **å½¹å‰²:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®å¯¾è©±ï¼ˆéŸ³å£°ãƒ»ç”»é¢ï¼‰ã¨ã€L1/L2ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ã—ã¦ã®æ€è€ƒï¼ˆAPIã‚³ãƒ¼ãƒ«ï¼‰ã‚’æ‹…å½“ã—ã¾ã™ã€‚
*   **ç‰¹å¾´:**
    *   ã‚­ã‚ªã‚¹ã‚¯ãƒ¢ãƒ¼ãƒ‰ã§å…¨ç”»é¢è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
    *   `packages/x402-sdk` ã‚’ä½¿ç”¨ã—ã¦ã€`apps/api` ã¨é€šä¿¡ã—ã¾ã™ã€‚
    *   `packages/ui` ã® `Orb` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆå…‰ã‚‹çƒä½“ï¼‰ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

### 2. `apps/dashboard` (Web Admin)
PCã‚„ã‚¹ãƒãƒ›ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ç®¡ç†ç”»é¢ã§ã™ã€‚
*   **å½¹å‰²:** ãƒ©ã‚ºãƒ‘ã‚¤ã§ã¯ã§ããªã„ã€Œè¤‡é›‘ãªè¨­å®šã€ã‚’è¡Œã„ã¾ã™ã€‚
*   **ç‰¹å¾´:**
    *   `packages/contracts` ã®å‹å®šç¾©ã‚’ä½¿ã£ã¦ã€ã‚ªãƒ³ãƒã‚§ãƒ¼ãƒ³ï¼ˆSmart Accountï¼‰ã®è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚
    *   Supabaseç­‰ã®DBã‚’å‚ç…§ã—ã€æ±ºæ¸ˆå±¥æ­´ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

### 3. `packages/types` (Rust â†” TS ã®æ¶ã‘æ©‹)
ã“ã“ãŒé–‹ç™ºåŠ¹ç‡ã®è‚ã§ã™ã€‚
*   **èª²é¡Œ:** Rustã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ã€TSã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§å‹å®šç¾©ï¼ˆ`PaymentPayload`ãªã©ï¼‰ãŒã‚ºãƒ¬ã‚‹ã¨ãƒã‚°ã«ãªã‚Šã¾ã™ã€‚
*   **è§£æ±º:** Rustã‚³ãƒ¼ãƒ‰ï¼ˆ`apps/api/src/types.rs`ï¼‰ã« `#[typeshare]` å±æ€§ã‚’ä»˜ã‘ã€è‡ªå‹•ç”Ÿæˆãƒ„ãƒ¼ãƒ«ï¼ˆtypeshareï¼‰ã‚’ä½¿ã£ã¦ã€ã“ã® `packages/types` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«TypeScriptã®å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ãå‡ºã—ã¾ã™ã€‚
*   **çµæœ:** ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯å¸¸ã«ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨åŒæœŸã—ãŸæ­£ã—ã„å‹ã‚’ä½¿ãˆã¾ã™ã€‚

### 4. `cargo-workspace`
pnpmãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã®ä¸­ã«ã€Rustã®ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ãŒåŒå±…ã™ã‚‹å½¢ã§ã™ã€‚
Rustãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ `cargo` ã‚³ãƒãƒ³ãƒ‰ã§ç›´æ¥ç®¡ç†ã—ã€TypeScriptãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ `pnpm` ã§ç®¡ç†ã—ã¾ã™ã€‚

```json
// root package.json example
{
  "scripts": {
    "web:dev": "pnpm --filter web dev",
    "docs:start": "pnpm --filter docs start",
    "build:web": "pnpm --filter web build",
    "build:rust": "cargo build --workspace --release",
    "dev:rust": "cargo watch --workspace -x run",
    "types:sync": "typeshare . --lang=typescript --output-file=packages/types/src/generated/index.ts"
  }
}
```

**æ³¨æ„:** Rustãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆ`merchant-api`ã€`facilitator-api`ï¼‰ã¯ `cargo` ã‚³ãƒãƒ³ãƒ‰ã§ç›´æ¥å®Ÿè¡Œã™ã‚‹ã‹ã€åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§èµ·å‹•ã—ã¾ã™ã€‚`pnpm` ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«çµ±åˆã™ã‚‹å ´åˆã¯ã€å„Rustãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã« `package.json` ã‚’è¿½åŠ ã—ã¦ãƒ©ãƒƒãƒ‘ãƒ¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®šç¾©ã™ã‚‹æ–¹æ³•ã‚‚ã‚ã‚Šã¾ã™ã€‚

---

## ğŸ›  é–‹ç™ºæ™‚ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

1.  **Rustã§APIä»•æ§˜ã‚’å¤‰æ›´ã™ã‚‹**
    *   `apps/api/src/types.rs` ã‚’ä¿®æ­£ã€‚
2.  **å‹ã‚’åŒæœŸã™ã‚‹ï¼ˆå‹ç”Ÿæˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å°å…¥æ™‚ï¼‰**
    *   `pnpm types:sync` ã‚’å®Ÿè¡Œ â†’ `packages/types` ãŒæ›´æ–°ã•ã‚Œã‚‹ã€‚
3.  **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’ä¿®æ­£ã™ã‚‹**
    *   `apps/web` ã‚„ `apps/device-ui` ã§æ–°ã—ã„å‹ã‚’ä½¿ã£ã¦å®Ÿè£…ã€‚
4.  **å‹•ä½œç¢ºèª**
    *   **TypeScriptã‚¢ãƒ—ãƒª:** `pnpm web:dev` ã‚„ `pnpm docs:start` ã§èµ·å‹•
    *   **Rust API:** åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ `cargo run --bin api` ã‚„ `cargo run --bin facilitator-api` ã‚’å®Ÿè¡Œ
    *   **ä¸€æ‹¬èµ·å‹•ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰:** è¤‡æ•°ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã‹ã€ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†ãƒ„ãƒ¼ãƒ«ï¼ˆ`concurrently`ãªã©ï¼‰ã‚’åˆ©ç”¨

ã“ã®æ§‹æˆã§ã‚ã‚Œã°ã€**ã€Œãƒ©ã‚ºãƒ‘ã‚¤ã®UIä½“é¨“ã€ã¨ã€ŒRustãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å …ç‰¢æ€§ã€**ã‚’ã€ä¸€ã¤ã®ãƒªãƒã‚¸ãƒˆãƒªã§åŠ¹ç‡ã‚ˆãç®¡ç†ãƒ»é–‹ç™ºã§ãã¾ã™ã€‚

