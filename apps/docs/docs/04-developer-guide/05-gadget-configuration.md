# ガジェット構成

このドキュメントでは、Oliverシステムのガジェット（物理デバイス）の構成について説明します。

## 概要

Oliverのガジェットは、Raspberry Pi 4をベースとした物理デバイスで、Python 3で実装されています。電子ペーパーディスプレイ、音声I/O、スーパーファミコン風コントローラーを統合し、AIエージェントとの対話インターフェースを提供します。レトロゲーム風のユーザー体験と、最先端のブロックチェーン決済を融合させたデバイスです。

## ハードウェア構成

### 主要コンポーネント

| コンポーネント | 役割 | 特徴 |
|---|---|---|
| **Raspberry Pi 4 Model B** | メインコンピューティングユニット | Python 3実行環境 |
| **4.2inch e-Paper Module** | 電子ペーパーディスプレイ | 低消費電力、視認性の高い表示、常時表示に適した特性 |
| **マイク** | 音声入力デバイス | 音声コマンド認識 |
| **スピーカー** | 音声出力デバイス | 音声フィードバック |
| **スーパーファミコン風コントローラー** | 物理入力デバイス | レトロゲーム風のユーザー体験、直感的な操作 |

### ハードウェア接続図

```text
┌─────────────────────────────────────────┐
│     Raspberry Pi 4 Model B              │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │   Oliverガジェットソフトウェア    │   │
│  │   (Python 3)                    │   │
│  └─────────────────────────────────┘   │
│                                         │
└───┬─────┬─────┬─────────┬──────────────┘
    │     │     │         │
    │     │     │         └─────┐
    │     │     │               │
┌───▼─┐ ┌─▼──┐ ┌▼────────┐  ┌──▼──────────────┐
│ e-  │ │マイク│ │スピーカー │  │スーファミ風      │
│Paper│ │    │ │         │  │コントローラー    │
└─────┘ └────┘ └─────────┘  └─────────────────┘
```

## Python実装の構成

### コアライブラリ

- **Python 3.9+**: メインプログラミング言語
- **Pillow (PIL)**: 画像処理・e-Paper描画
- **RPi.GPIO**: GPIO制御
- **spidev**: SPIインターフェース通信
- **pyaudio**: オーディオ入力/出力
- **requests**: HTTP通信（API連携）
- **pygame**: コントローラー入力処理

### 推奨ライブラリ

- **speech_recognition**: 音声認識
- **pyttsx3** または **gTTS**: 音声合成
- **evdev**: 入力デバイス制御
- **asyncio**: 非同期処理
- **websockets**: WebSocket通信（リアルタイム更新用）

## 主要機能

### e-Paperディスプレイ表示

4.2インチ電子ペーパーディスプレイによる視認性の高い情報表示：

- **待機画面**: AIエージェントのステータス表示
- **決済画面**: 金額、商品情報の表示
- **完了画面**: トランザクション結果の表示

### 音声対話インターフェース

マイクとスピーカーによる自然な音声対話：

- **音声入力**: マイクからの音声コマンド認識
- **音声応答**: スピーカーからのフィードバック

### コントローラー操作

スーパーファミコン風コントローラーによる直感的な操作：

- **十字キー**: メニューナビゲーション
- **Aボタン**: 決定
- **Bボタン**: キャンセル
- **Start/Selectボタン**: メニュー・設定

## セットアップ手順

### 1. Raspberry Pi 4の準備

- Raspberry Pi OS（64-bit推奨）をインストール
- Python 3.9以上をインストール
- 必要なシステムパッケージを更新

### 2. e-Paperディスプレイの接続

- SPIインターフェースを有効化（`raspi-config`）
- ディスプレイをGPIOピンに接続
- ドライバーライブラリをインストール

### 3. オーディオデバイスの設定

- マイクを接続（USB推奨）
- スピーカーを接続（3.5mmジャック、USB、またはHDMI）
- オーディオデバイスの認識を確認

### 4. コントローラーの接続

- USBポートにコントローラーを接続
- デバイス認識を確認
- 入力テストを実施

### 5. 自動起動設定

- systemdサービスとして登録
- 起動時に自動実行されるよう設定
- サービスの動作を確認

## デバイス仕様

### e-Paperディスプレイ

- **解像度**: 400×300ピクセル（4.2インチモデル）
- **接続**: SPIインターフェース
- **更新レート**: 部分更新対応
- **消費電力**: 低消費電力（表示維持時はほぼゼロ）
- **表示色**: モノクロ（白黒2階調）

### 音声入出力

- **音声認識**: 
  - オンライン: Google Speech API
  - オフライン: CMU Sphinx
- **音声合成**: 
  - オフライン: pyttsx3
  - オンライン: gTTS
- **対応言語**: 日本語、英語

### コントローラー

- **接続**: USB接続
- **入力遅延**: 低遅延設計
- **ボタン構成**:
  - 十字キー
  - A/Bボタン
  - Start/Selectボタン

## 今後の拡張予定

### ハードウェア拡張

- **e-Paperアニメーション**: 滑らかな画面遷移効果
- **ジェスチャー認識**: コントローラーのモーション検出
- **LED表示**: ステータスインジケーター追加
- **バッテリー駆動**: ポータブル化対応

### ソフトウェア拡張

- **音声インターフェース強化**: より自然な対話体験
- **オフライン音声認識**: 完全なローカル処理
- **マルチ言語対応**: 多言語音声認識・合成

### 機能拡張

- **QRコード表示**: e-Paper上でのQRコード生成
- **NFC対応**: 非接触決済機能

