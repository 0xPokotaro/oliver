# エラーハンドリング要件

## 基本方針

- エラーハンドリングは**service層で行う**
- service層でエラーをthrowするだけで、アプリ全体のエラーハンドラーが適切なHTTPレスポンスに変換する
- ルート層ではエラーハンドリングを行わない

## エラークラス

以下のカスタムエラークラスを使用する：

- `AppError`: 基底クラス（HTTPステータスコード、エラーコード、メッセージを含む）
- `NotFoundError`: 404エラー（リソースが見つからない場合）
- `UnauthorizedError`: 401エラー（認証エラー）
- `BadRequestError`: 400エラー（リクエストが不正な場合）
- `InternalServerError`: 500エラー（サーバー内部エラー）

## service層での実装

- エラーが発生した場合は、適切なカスタムエラークラスをthrowする
- `null`を返すのではなく、エラーをthrowする（例：`getUserProfile`でユーザーが見つからない場合は`NotFoundError`をthrow）
- エラーメッセージとエラーコードを明確に指定する

## エラーレスポンス形式

エラーレスポンスは以下の形式で返される：

```json
{
  "error": "エラーメッセージ",
  "code": "ERROR_CODE",
  "message": "エラーメッセージ"
}
```

## 自動処理されるエラー

以下のエラーは自動的に処理される：

- `AppError`のサブクラス: 適切なHTTPステータスコードで返される
- `ZodError`: バリデーションエラーとして400で返される
- その他のエラー: 500エラーとして返される

